<!DOCTYPE html> 
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Inscription √âv√©nement</title>
<style>
/* ===== Reset & Base ===== */
*,
*::before,
*::after { box-sizing: border-box; }

body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  color: var(--text);
  line-height: 1.5;
}

/* ===== Variables UI ===== */
:root {
  --bg: #f5f6fa;
  --card: #ffffff;
  --text: #1f2937;
  --muted: #6b7280;
  --primary: #007bff;
  --primary-dark: #0056b3;
  --ring: 0 0 0 3px rgba(0,123,255,.18);

  --card-max: 720px;
  --card-side: 28px;
}

/* ===== Fond dynamique (flou) ===== */
:root { --event-bg-url: url("/static/img/placeholder.png"); }
body::before {
  content: "";
  position: fixed; inset: 0; z-index: -2;
  background-image: var(--event-bg-url);
  background-size: cover; background-position: center;
  filter: blur(16px); transform: scale(1.1);
}
body::after {
  content: "";
  position: fixed; inset: 0; z-index: -1;
  background: linear-gradient(to bottom, rgba(0,0,0,.3), rgba(0,0,0,.15) 30%, rgba(0,0,0,.3));
  pointer-events: none;
}

/* ===== Header (banni√®re) ===== */
.event-header {
  position: relative;
  width: 95%;
  max-width: var(--card-max);
  margin: 28px auto 14px;
  overflow: hidden;
  border-radius: 18px;
  box-shadow: 0 12px 28px rgba(0,0,0,.08);
}
.event-header img {
  width: 100%;
  height: clamp(200px, 30vw, 260px);
  object-fit: cover;
  display: block;
  border-radius: 18px;
}
.event-header::after {
  content: "";
  position: absolute; inset: auto 0 0 0;
  height: 140px;
  background: linear-gradient(to top, rgba(0,0,0,0.75), transparent);
  border-radius: 0 0 18px 18px;
}
.event-header h2 {
  position: absolute;
  bottom: 20px; left: 22px;
  margin: 0;
  padding: 10px 14px;
  color: #fff;
  font-size: clamp(1.4rem, 3.8vw, 2.2rem);
  font-weight: 700;
  text-shadow: 0 3px 8px rgba(0,0,0,.6);
  z-index: 2;
  backdrop-filter: blur(3px);
  border-radius: 10px;
}

/* ===== Carte principale (cadre) ===== */
.box {
  width: 95%;
  max-width: var(--card-max);
  background: rgba(255,255,255,.97);
  margin: 12px auto 46px;
  padding: 30px var(--card-side);
  border-radius: 18px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 10px 32px rgba(0,0,0,.09);
  transition: transform .25s;
}
.box:hover { transform: translateY(-3px); }

h3 {
  margin: 0 0 16px;
  color: var(--primary);
  text-align: center;
  font-weight: 700;
  font-size: 1.25rem;
  letter-spacing: .3px;
}
p { margin: 8px 0; }

/* S√©parateur d√©grad√© */
.box hr {
  margin: 26px 0;
  border: none; height: 2px;
  background: linear-gradient(90deg, var(--primary), #00c6ff);
  border-radius: 2px;
}

/* ===== Infos √©v√©nement (version row moderne) ===== */
.event-details {
  display: flex;
  flex-direction: column;
  gap: 14px;
  margin-bottom: 20px;
}
.detail-row {
  display: flex;
  align-items: center;
  background: #fafafa;
  border-radius: 14px;
  padding: 12px 16px;
  gap: 12px;
  box-shadow: inset 0 1px 2px rgba(0,0,0,.05);
}
.detail-row .icon {
  flex-shrink: 0;
  width: 38px;
  height: 38px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  color: white;
}
.icon.date { background: #007bff; }
.icon.location { background: #ef4444; }
.icon.price { background: #8b5cf6; }

/* Description */
.about-title {
  font-size: 1.25rem;
  font-weight: bold;
  margin-bottom: 10px;
  color: #374151;
  text-align: left;
  position: relative;
}
.about-title::after {
  content: "";
  position: absolute; left: 0; bottom: -6px;
  width: 46px; height: 3px;
  background: linear-gradient(90deg, var(--primary), #00c6ff);
  border-radius: 3px;
}
.description {
  margin: 12px 0 30px;
  background: #fafbff;
  border: 1px solid #eef2f7;
  padding: 14px 16px;
  border-radius: 12px;
  color: #4b5563;
}

/* ===== Formulaire ===== */
#registerForm {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 10px;
}
#registerForm input {
  width: 100%;
  padding: 12px 14px;
  border: 1px solid #d1d5db;
  border-radius: 12px;
  font-size: 1rem;
  background: #fff;
  transition: border-color .2s, box-shadow .2s;
}
#registerForm input::placeholder { color:#94a3b8; }
#registerForm input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: var(--ring);
}
#registerForm input:invalid:focus { border-color:#ef4444; box-shadow: 0 0 0 3px rgba(239,68,68,.16); }
#registerForm input:valid:focus { border-color:#10b981; box-shadow: 0 0 0 3px rgba(16,185,129,.16); }

/* ===== Bouton inscription ===== */
#custom-paypal-btn {
  width: 100%;
  max-width: 520px;
  background: linear-gradient(90deg, #007bff, #7b2ff7);
  color: #fff;
  border: none;
  padding: 14px 26px;
  border-radius: 14px;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  transition: all .3s;
  margin: 22px auto 0;
  display: block;
  position: relative;
  box-shadow: 0 8px 20px rgba(0,123,255,.28);
}
#custom-paypal-btn:hover {
  transform: scale(1.04);
  box-shadow: 0 12px 28px rgba(0,86,179,.3);
}
#custom-paypal-btn.loading { cursor: wait; opacity: .85; }
#custom-paypal-btn.loading::after {
  content: "";
  position: absolute; right: 16px; top: 50%;
  width: 16px; height: 16px;
  border: 2px solid white; border-top: 2px solid transparent;
  border-radius: 50%; transform: translateY(-50%);
  animation: spin .8s linear infinite;
}
@keyframes spin { to { transform: translateY(-50%) rotate(360deg); } }

#paypal-button-container { margin-top: 16px; display:flex; justify-content:center; }
#cancel-container { margin-top: 12px; }

/* ===== Messages ===== */
#message { margin-top: 12px; }
.success {
  color: #065f46;
  background: #ecfdf5;
  border: 1px solid #a7f3d0;
  padding: 10px 14px;
  border-radius: 12px;
  font-weight: 600;
  margin-top: 12px;
}
.error {
  color: #7f1d1d;
  background: #fee2e2;
  border: 1px solid #fecaca;
  padding: 10px 14px;
  border-radius: 12px;
  font-weight: 600;
  margin-top: 12px;
}

/* ===== Responsive ===== */
@media (max-width: 768px) {
  .event-header { width: 94%; border-radius: 14px; }
  .event-header img { height: 220px; border-radius: 14px; }
  .event-header h2 { font-size: 1.5rem; left: 14px; bottom: 12px; }

  .box { width: 94%; padding: 24px 18px 26px; }

  #custom-paypal-btn { max-width: none; }
  .description { padding: 12px; }
}
</style>
</head>
<body>

  <!-- ‚úÖ Header -->
  <div class="event-header">
    <img id="event-image" src="/static/img/placeholder.png" alt="Image de l'√©v√©nement">
    <h2 id="event-title">Chargement...</h2>
  </div>

  <!-- ‚úÖ Box infos am√©lior√©e -->
  <div class="box">
    <h3 class="about-title">√Ä propos de l‚Äô√©v√©nement</h3>
    <p id="event-description" class="description"></p>

    <!-- ‚úÖ D√©tails modernes -->
    <div class="event-details">
      <div class="detail-row">
        <div class="icon date">üìÖ</div>
        <span id="event-date"></span>
      </div>
      <div class="detail-row">
        <div class="icon location">üìç</div>
        <span id="event-location"></span>
      </div>
      <div class="detail-row">
        <div class="icon price">üí∂</div>
        <span id="event-price"></span> ‚Ç¨
      </div>
    </div>

    <!-- ‚úÖ Carte -->
    <div id="map-container"
         style="width:95%;max-width:680px;height:320px;margin:0 auto 40px;
                border-radius:16px;overflow:hidden;box-shadow:0 6px 20px rgba(0,0,0,.1);">
    </div>

    <hr>

    <h3>Inscription</h3>
    <div id="message"></div>
    <form id="registerForm">
      <input type="text" id="first_name" placeholder="Votre pr√©nom" required>
      <input type="text" id="last_name" placeholder="Votre nom" required>
      <input type="email" id="email" placeholder="Votre email" required>
    </form>

    <button id="custom-paypal-btn">M‚Äôinscrire</button>
    <div id="paypal-button-container"></div>
    <div id="cancel-container" style="text-align:center; margin-top:10px;"></div>
  </div>

<script>
  let eventId = new URLSearchParams(location.search).get("id"); // si vide ‚Üí mode mock

  const pick = (o, ...keys) => {
    for (const k of keys) if (o && o[k] != null && o[k] !== "") return o[k];
    return undefined;
  };

  // ‚úÖ Afficher la carte
  function showMap(place) {
    const mapDiv = document.getElementById("map-container");
    if (!mapDiv || !window.google || !google.maps) return;
    const geocoder = new google.maps.Geocoder();
    geocoder.geocode({ address: place }, (results, status) => {
      if (status === "OK" && results[0]) {
        const loc = results[0].geometry.location;
        const map = new google.maps.Map(mapDiv, {
          center: loc,
          zoom: 15,
          mapId: "7cfc3f3b2bd280bbb9fe24ef"
        });
        new google.maps.marker.AdvancedMarkerElement({ position: loc, map: map });
      }
    });
  }

  async function loadEvent() {
    // Mode MOCK si pas d'eventId
    if (!eventId) {
      const fakeEvent = {
        title: "Conf√©rence Paris 2025",
        description: "Un grand rassemblement professionnel avec des invit√©s internationaux.",
        date: "2025-09-06",
        location: "Eiffel Tower, Paris, France",
        price: "25",
        image_url: "https://via.placeholder.com/800x400.png?text=Conf%C3%A9rence+Paris+2025"
      };
      document.getElementById("event-title").textContent = fakeEvent.title;
      document.getElementById("event-description").textContent = fakeEvent.description;
      document.getElementById("event-date").textContent = fakeEvent.date;
      document.getElementById("event-location").textContent = fakeEvent.location;
      document.getElementById("event-price").textContent = fakeEvent.price;
      document.getElementById("event-image").src = fakeEvent.image_url;
      return;
    }

    // Sinon mode API normal
    try {
      const resEvent = await fetch(`/api/event/${encodeURIComponent(eventId)}`, {
        headers: { "Accept": "application/json" }
      });
      if (!resEvent.ok) return;
      const dataEvent = await resEvent.json();
      const ev = dataEvent.event || dataEvent;

      document.getElementById("event-title").textContent = pick(ev, "title", "name") || "√âv√©nement";
      document.getElementById("event-description").innerHTML = pick(ev, "description", "desc") || "Pas de description disponible.";
      document.getElementById("event-date").textContent = pick(ev, "date", "event_date", "start_date") || "‚Äî";
      document.getElementById("event-location").textContent = pick(ev, "location", "place", "city", "venue") || "‚Äî";
      document.getElementById("event-price").textContent = pick(ev, "price", "amount", "price_eur") ?? 0;
      const imgUrl = pick(ev, "image_url", "image", "cover", "banner_url");
      document.getElementById("event-image").src = imgUrl || "/static/img/placeholder.png";
    } catch (e) { console.error(e); }
  }

  loadEvent();
</script>

<script>
async function loadGoogleMaps() {
  try {
    const res = await fetch("/api/config/maps-key");
    const data = await res.json();
    if (!data.key) return;
    const script = document.createElement("script");
    script.src = `https://maps.googleapis.com/maps/api/js?key=${data.key}&libraries=places,marker&loading=async`;
    script.async = true;
    script.defer = true;
    document.head.appendChild(script);
  } catch (err) { console.error("Erreur chargement Google Maps:", err); }
}
loadGoogleMaps();
</script>

</body>
</html>
